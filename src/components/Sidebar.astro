---
// src/components/Sidebar.astro

import { format } from "date-fns";
import { pl } from "date-fns/locale/pl";

const eventFiles = await Astro.glob('../content/events/*.md');
const events = eventFiles.map(event => {
  return {
    ...event.frontmatter,
    startDate: new Date(event.frontmatter.start_date),
    slug: event.file.split('/').pop().split('.').shift()
  }
})
// .filter(event => event.startDate >= new Date())
.sort((a, b) => b.startDate - a.startDate);
// .slice(0, 10);
---

<div >
  <div class="bg-gray-800 rounded-xl p-5 mb-6">
    <h3 class="text-xl font-bold mb-4 text-white text-center">KALENDARZ</h3>
    <div class="bg-gray-900 rounded-lg p-4">
      <div class="text-center mb-4">
        <span class="text-xl font-bold text-white">LISTOPAD 2023</span>
      </div>
      <div class="grid grid-cols-7 gap-2 mb-2">
        <div class="text-center text-gray-500">Pn</div>
        <div class="text-center text-gray-500">Wt</div>
        <div class="text-center text-gray-500">Śr</div>
        <div class="text-center text-gray-500">Cz</div>
        <div class="text-center text-gray-500">Pt</div>
        <div class="text-center text-gray-500">So</div>
        <div class="text-center text-gray-500">Nd</div>
      </div>
      <div class="grid grid-cols-7 gap-2">
        <div class="text-center py-1 text-gray-600">30</div>
        <div class="text-center py-1 text-gray-600">31</div>
        <div class="text-center py-1">1</div>
        <div class="text-center py-1">2</div>
        <div class="text-center py-1">3</div>
        <div class="text-center py-1">4</div>
        <div class="text-center py-1">5</div>
        <div class="text-center py-1">6</div>
        <div class="text-center py-1">7</div>
        <div class="text-center py-1">8</div>
        <div class="text-center py-1">9</div>
        <div class="text-center py-1">10</div>
        <div class="text-center py-1">11</div>
        <div class="text-center py-1">12</div>
        <div class="text-center py-1">13</div>
        <div class="text-center py-1">14</div>
        <div class="text-center py-1">15</div>
        <div class="text-center py-1 bg-primary rounded-full text-white">16</div>
        <div class="text-center py-1">17</div>
        <div class="text-center py-1">18</div>
        <div class="text-center py-1">19</div>
        <div class="text-center py-1">20</div>
        <div class="text-center py-1">21</div>
        <div class="text-center py-1 bg-accent rounded-full text-dark font-bold">22</div>
        <div class="text-center py-1">23</div>
        <div class="text-center py-1">24</div>
        <div class="text-center py-1">25</div>
        <div class="text-center py-1">26</div>
        <div class="text-center py-1">27</div>
        <div class="text-center py-1">28</div>
        <div class="text-center py-1">29</div>
        <div class="text-center py-1">30</div>
        <div class="text-center py-1 text-gray-600">1</div>
      </div>
      <div class="mt-4">
        <div class="flex items-center mb-2">
          <div class="w-4 h-4 bg-primary rounded-full mr-2"></div>
          <span class="text-sm text-gray-300">Bitwa freestyle</span>
        </div>
        <div class="flex items-center">
          <div class="w-4 h-4 bg-accent rounded-full mr-2"></div>
          <span class="text-sm text-gray-300">Koncert</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Mapa wydarzeń -->
  {
    /* {events.length > 0 && events[0].google_maps_url && (
            <div class="glass-card animate-fade-in p-6">
              <h3 class="font-heading font-semibold text-xl mb-4">Najbliższe wydarzenie</h3>
              <div class="map-container">
                <iframe
                  src={events[0].google_maps_url.replace('/place/', '/embed/')}
                  allowFullScreen
                  loading="lazy"
                ></iframe>
              </div>
            </div>
          )} */
  }

  {
    events.length > 0 && (
      <div class="bg-gray-800 rounded-xl p-5 mb-6">
        <h3 class="text-xl font-bold mb-4 text-white text-center">NAJBLIŻSZE WYDARZENIE</h3>
        <div class="bg-gradient-to-r from-purple-900 to-purple-700 rounded-lg p-4">
          <div class="text-center text-white font-bold mb-2">{format(new Date(events[0].startDate), "d MMMM", { locale: pl })}</div>
          <h4 class="text-lg font-bold text-white mb-2">{events[0].title}</h4>
          <p class="text-gray-300 mb-3">
            <i class="fas fa-map-marker-alt mr-2" /> {events[0].location || "Nieznazna"}
          </p>
          <p class="text-gray-300 mb-4">
            <i class="far fa-clock mr-2" /> Start: {format(new Date(events[0].startDate), "HH:mm:ss", { locale: pl })}
          </p>
          <button class="w-full bg-primary text-white py-2 rounded-lg hover:bg-opacity-90 transition">
            <i class="fas fa-ticket-alt mr-2" /> Kup bilet
          </button>
          <button class="w-full bg-gray-700 text-white py-2 rounded-lg mt-2 hover:bg-gray-600 transition">
            <i class="fas fa-map-marker-alt mr-2" /> Pokaż na mapie
          </button>
        </div>
      </div>
    )
  }

  <div class="glass-card animate-fade-in p-6">
    <div class="grid grid-cols-2 gap-4">
      <div class="bg-indigo-900/30 p-4 rounded-lg text-center">
        <div class="text-3xl font-bold text-indigo-300">24</div>
        <div class="text-sm text-indigo-400 mt-1">Nadchodzących wydarzeń</div>
      </div>
      <div class="bg-indigo-900/30 p-4 rounded-lg text-center">
        <div class="text-3xl font-bold text-pink-300">2</div>
        <div class="text-sm text-indigo-400 mt-1">W tym miesiącu</div>
      </div>
    </div>
  </div>

  <div class="bg-gradient-to-r from-blue-900 to-blue-700 rounded-xl p-5 mb-6">
    <h3 class="text-xl font-bold mb-4 text-white text-center">NASI PARTNERZY</h3>
    <div class="rounded-lg">
      <div class="grid gap-2">
        <a
          href="https://www.facebook.com/JandD.VideoProductions/"
          target="_blank"
          rel="noopener noreferrer"
          class="group text-center glass-card bg-opacity-60 rounded-lg p-3 transition-all hover:bg-opacity-80 mx-auto"

        >
          <img
            src="/images/uploads/logo-jd-video-2.png"
            alt="Partner J&D Video Production logo"
            class="w-1/2 mb-2 object-contain opacity-90 group-hover:opacity-100 transition-opacity mx-auto"

          />
          <span class="text-white font-medium text-center group-hover:text-blue-300 transition-colors">
            J&amp;D Video Production
          </span>
        </a>
      </div>
      <button class="w-full bg-blue-600 text-white py-2 rounded-lg mt-4 hover:bg-blue-500 transition">
        <i class="fas fa-handshake mr-2"></i> Zostań partnerem
      </button>
    </div>
  </div>

  <div class="glass-card animate-fade-in p-6">
    <h3 class="font-heading font-semibold text-xl mb-4">Dodaj własne wydarzenie</h3>
    <p class="text-blue-300 mb-4">
      Chcesz dodać swoje wydarzenie do naszego kalendarza? Skorzystaj z formularza i wyślij propozycję.
    </p>
    <a
      href="/admin/"
      class="gradient-bg hover:opacity-90 text-white w-full py-3 rounded-lg transition-all duration-300 font-medium shadow-lg hover:shadow-xl flex items-center justify-center"

    >
      <i class="fas fa-edit mr-2"></i>Formularz
    </a>
  </div>
</div>
