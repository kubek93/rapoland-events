---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import Calendar from '../components/Calendar.astro';
import EventList from '../components/EventList.astro';

// Pobierz wszystkie wydarzenia
const eventFiles = await Astro.glob('../content/events/*.md');
const events = eventFiles.map(event => ({
  ...event.frontmatter,
  date: event.frontmatter.date,
  slug: typeof event.file === 'string' ? event.file.split('/').pop()?.split('.')?.shift() ?? '' : ''
})).filter(event => new Date(event.date) >= new Date())
  .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
---

<Layout title="Future Events">
  <div class="container mx-auto px-4 py-8">
    <div class="flex flex-col lg:flex-row gap-8">
      <div class="w-full lg:w-1/3">
        <Calendar events={events} />

        <div class="bg-white rounded-xl shadow-lg mt-8 p-6">
          <h3 class="font-semibold text-lg mb-4">Filter Events</h3>
          <form class="space-y-4" id="filter-form">
            <div>
              <label class="block text-gray-700 mb-2">Category</label>
              <select name="category" class="w-full p-2 border rounded-lg">
                <option value="">All Categories</option>
                {Array.from(new Set(events.map(e => e.category))).map(cat => (
                  <option value={cat}>{cat}</option>
                ))}
              </select>
            </div>
            <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg transition duration-300">
              Apply Filters
            </button>
          </form>
        </div>
      </div>

      <div class="w-full lg:w-2/3">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Upcoming Events</h2>
          <div class="text-sm">
            Showing {events.length} events
          </div>
        </div>

        <EventList events={events} />
      </div>
    </div>
  </div>

  <script>
    document.getElementById('filter-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const category = e.target.category.value;
      window.location.href = category ? `/events/category/${category.toLowerCase()}/` : '/';
    });
  </script>
</Layout>
