---
import { format } from 'date-fns';
import { pl } from 'date-fns/locale/pl';

const { news, title, description } = Astro.props;

const formatDate = (date) => {
  return date ? format(date, 'd MMMM yyyy, HH:mm', { locale: pl }) : '';
};
---

<section class="py-6 bg-underground street-border">
  <div class="container mx-auto px-4">
    <div class="flex justify-between items-center mb-8">
      <div>
        <h2 class="text-3xl font-heading font-bold text-white">{title}</h2>
        <p class="text-blue-300 text-md mt-2">{description}</p>
      </div>
      <div class="flex items-center space-x-4">
        <a href="#" class="text-primary font-medium flex items-center hover:text-red-500">
          Zobacz wszystkie <i class="fas fa-arrow-right ml-2"></i>
        </a>
      </div>
    </div>

    <div class="news-scroll-container flex overflow-x-auto pb-6 space-x-4">
      {news.map(newsItem => (
        <div class="flex-shrink-0 w-80 bg-gray-900 rounded-xl overflow-hidden card-hover">
          {newsItem.thumbnail ? (
            <div class="h-40 relative">
              <img
                src={newsItem.thumbnail}
                alt={newsItem.title}
                class="w-full h-full object-cover"
                style="min-height: 10rem; max-height: 10rem;"
              />
              <div class="absolute top-4 left-4 bg-primary text-dark py-1 px-3 rounded-lg font-bold">NOWOŚĆ</div>
            </div>
          ) : (
            <div class="h-40 bg-gradient-to-r from-purple-900 to-purple-700 relative">
              <div class="absolute top-4 left-4 bg-primary text-dark py-1 px-3 rounded-lg font-bold">NOWOŚĆ</div>
            </div>
          )}
          <div class="p-5">
            <span class="text-sm text-primary font-medium">{newsItem.category}</span>
            <h3 class="text-xl font-bold my-3 text-white">{newsItem.title}</h3>
            <p class="text-gray-400 mb-4">
              {newsItem.short_description.slice(0, 80) + '...'}
            </p>
            <div class="flex items-center text-gray-500">
              <i class="far fa-clock mr-2"></i>
              <span>
                {(() => {
                  const now = new Date();
                  const date = new Date(newsItem.date);
                  const diffMs = now - date;
                  const diffSec = Math.floor(diffMs / 1000);
                  const diffMin = Math.floor(diffSec / 60);
                  const diffHour = Math.floor(diffMin / 60);
                  const diffDay = Math.floor(diffHour / 24);

                  if (diffDay === 0) {
                    if (diffHour === 0) {
                      if (diffMin < 2) return 'przed chwilą';
                      if (diffMin < 60) return `dzisiaj, ${diffMin} min temu`;
                      return `dzisiaj, ${diffHour} godz temu`;
                    }
                    return `dzisiaj, ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                  }
                  if (diffDay === 1) {
                    return `wczoraj, ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                  }
                  if (diffDay < 7) {
                    return `${diffDay} dni temu`;
                  }
                  // Fallback to formatted date
                  return formatDate(date);
                })()}
              </span>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>
